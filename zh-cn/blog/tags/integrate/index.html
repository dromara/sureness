<!doctype html>
<html lang="zh-cn" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/sureness/zh-cn/blog/rss.xml" title="Sureness Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/sureness/zh-cn/blog/atom.xml" title="Sureness Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Sureness" href="/sureness/zh-cn/opensearch.xml">
<link rel="icon" href="img/icon64.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(234, 90, 7)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="img/icon64.png">
<link rel="mask-icon" href="img/icon64.svg" color="rgb(234, 90, 7)">
<meta name="msapplication-TileImage" content="img/icon64.png">
<meta name="msapplication-TileColor" content="#000">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;600&display=block">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&display=block">
<script src="https://buttons.github.io/buttons.js"></script><title data-react-helmet="true">Posts tagged &quot;integrate&quot; | Sureness</title><meta data-react-helmet="true" property="og:title" content="Posts tagged &quot;integrate&quot; | Sureness"><meta data-react-helmet="true" name="description" content="Blog | Tagged &quot;integrate&quot;"><meta data-react-helmet="true" property="og:description" content="Blog | Tagged &quot;integrate&quot;"><meta data-react-helmet="true" property="og:url" content="https://dromara.org/sureness/zh-cn/blog/tags/integrate"><meta data-react-helmet="true" name="docsearch:language" content="zh-cn"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><meta data-react-helmet="true" property="og:image" content="https://dromara.org/sureness/zh-cn/img/icon64128.png"><meta data-react-helmet="true" name="twitter:image" content="https://dromara.org/sureness/zh-cn/img/icon64128.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link data-react-helmet="true" rel="shortcut icon" href="/sureness/zh-cn/img/icon64.png"><link data-react-helmet="true" rel="canonical" href="https://dromara.org/sureness/zh-cn/blog/tags/integrate"><link data-react-helmet="true" rel="alternate" href="https://dromara.org/sureness/blog/tags/integrate" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://dromara.org/sureness/zh-cn/blog/tags/integrate" hreflang="zh-cn"><link data-react-helmet="true" rel="alternate" href="https://dromara.org/sureness/blog/tags/integrate" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://GNVT7Z0UI2-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/sureness/zh-cn/assets/css/styles.f7e5e551.css">
<link rel="preload" href="/sureness/zh-cn/assets/js/runtime~main.0b379c3a.js" as="script">
<link rel="preload" href="/sureness/zh-cn/assets/js/main.578398a9.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/sureness/zh-cn/"><img src="/sureness/zh-cn/img/icon128.svg" alt="Focusing on Protection of REST API" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/sureness/zh-cn/img/icon128.svg" alt="Focusing on Protection of REST API" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title"> </strong></a><a class="navbar__item navbar__link" href="/sureness/zh-cn/docs/">æ–‡æ¡£</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/sureness/zh-cn/blog">åšå®¢</a><a href="https://github.com/dromara/sureness/projects/1" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">çœ‹æ¿</a><a href="https://github.com/tomsun28/sureness-shiro-spring-security-benchmark" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">é«˜æ€§èƒ½</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">è®¨è®º</a><ul class="dropdown__menu"><li><a href="https://github.com/dromara/sureness/discussions" target="_blank" rel="noopener noreferrer" class="dropdown__link">Github Discussion</a></li><li><a href="https://gitter.im/usthe/sureness" target="_blank" rel="noopener noreferrer" class="dropdown__link">Gitter Channel</a></li><li><a href="https://qm.qq.com/cgi-bin/qm/qr?k=3IpzQjFOztJe464_eMBmDHfT0YTWK5Qa&amp;jump_from=webapi" target="_blank" rel="noopener noreferrer" class="dropdown__link">QQ ç¾¤ - 282870345</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">å…¶å®ƒ</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/sureness/zh-cn/docs/design">è®¾è®¡æ–‡æ¡£</a></li><li><a class="dropdown__link" href="/sureness/zh-cn/docs/contributing">å‚ä¸è´¡çŒ®</a></li><li><a class="dropdown__link" href="/sureness/zh-cn/docs/sponsor">èµåŠ©</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>ä¸­æ–‡ï¼ˆä¸­å›½ï¼‰</span></span></a><ul class="dropdown__menu"><li><a href="/sureness/blog/tags/integrate" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/sureness/zh-cn/blog/tags/integrate" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">ä¸­æ–‡ï¼ˆä¸­å›½ï¼‰</a></li></ul></div><a href="https://github.com/dromara/sureness" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT" style="margin-left:2px">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT" style="margin-left:1px">â˜€ï¸</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/sureness/zh-cn/"><img src="/sureness/zh-cn/img/icon128.svg" alt="Focusing on Protection of REST API" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/sureness/zh-cn/img/icon128.svg" alt="Focusing on Protection of REST API" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title"> </strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/sureness/zh-cn/docs/">æ–‡æ¡£</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/sureness/zh-cn/blog">åšå®¢</a></li><li class="menu__list-item"><a href="https://github.com/dromara/sureness/projects/1" target="_blank" rel="noopener noreferrer" class="menu__link">çœ‹æ¿</a></li><li class="menu__list-item"><a href="https://github.com/tomsun28/sureness-shiro-spring-security-benchmark" target="_blank" rel="noopener noreferrer" class="menu__link">é«˜æ€§èƒ½</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">è®¨è®º</a><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/dromara/sureness/discussions" target="_blank" rel="noopener noreferrer" class="menu__link">Github Discussion</a></li><li class="menu__list-item"><a href="https://gitter.im/usthe/sureness" target="_blank" rel="noopener noreferrer" class="menu__link">Gitter Channel</a></li><li class="menu__list-item"><a href="https://qm.qq.com/cgi-bin/qm/qr?k=3IpzQjFOztJe464_eMBmDHfT0YTWK5Qa&amp;jump_from=webapi" target="_blank" rel="noopener noreferrer" class="menu__link">QQ ç¾¤ - 282870345</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">å…¶å®ƒ</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/sureness/zh-cn/docs/design">è®¾è®¡æ–‡æ¡£</a></li><li class="menu__list-item"><a class="menu__link" href="/sureness/zh-cn/docs/contributing">å‚ä¸è´¡çŒ®</a></li><li class="menu__list-item"><a class="menu__link" href="/sureness/zh-cn/docs/sponsor">èµåŠ©</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a href="#" role="button" class="menu__link menu__link--sublist"><span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>Languages</span></span></a><ul class="menu__list"><li class="menu__list-item"><a href="/sureness/blog/tags/integrate" target="_self" rel="noopener noreferrer" class="menu__link" style="text-transform:capitalize">English</a></li><li class="menu__list-item"><a href="/sureness/zh-cn/blog/tags/integrate" target="_self" rel="noopener noreferrer" class="menu__link dropdown__link--active" style="text-transform:capitalize">ä¸­æ–‡ï¼ˆä¸­å›½ï¼‰</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/dromara/sureness" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub repository"></a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-tags-post-page"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">Recent posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/sureness/zh-cn/blog/2021/06/06/step-by-step">ä½¿ç”¨Surenessä¸€æ­¥ä¸€æ­¥æ­å»ºä¸€ä¸ªå®Œæ•´è®¤è¯é‰´æƒé¡¹ç›®</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/sureness/zh-cn/blog/2021/04/29/sample-micronaut">Using Sureness to secure micronaut REST API</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/sureness/zh-cn/blog/2021/04/16/sample-javalin">Using Sureness to secure Javalin REST API</a></li></ul></div></div><main class="col col--7"><h1>One post tagged with &quot;integrate&quot;</h1><a href="/sureness/zh-cn/blog/tags">View All Tags</a><div class="margin-vert--xl"><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/sureness/zh-cn/blog/2021/06/06/step-by-step">ä½¿ç”¨Surenessä¸€æ­¥ä¸€æ­¥æ­å»ºä¸€ä¸ªå®Œæ•´è®¤è¯é‰´æƒé¡¹ç›®</a></h2><div class="margin-vert--md"><time datetime="2021-06-06T00:00:00.000Z" class="blogPostDate_fNvV">2021å¹´6æœˆ6æ—¥ Â· One min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/tomsun28" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/24788200?s=400&amp;v=4" alt="tom"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/tomsun28" target="_blank" rel="noopener noreferrer">tom</a></h4><small class="avatar__subtitle">Java Engineer</small></div></div></header><div class="markdown"><p>ä¸‹é¢æˆ‘ä»¬æ¥ä¸€æ­¥ä¸€æ­¥åŸºäºspringboot,surenessæ­å»ºä¸€ä¸ªå¦‚ä¸‹åŠŸèƒ½çš„è®¤è¯é‰´æƒç³»ç»Ÿã€‚  </p><ol><li>ä½¿ç”¨äº†é…ç½®æ–‡ä»¶æ¥ä½œä¸ºç³»ç»Ÿçš„è´¦æˆ·æ•°æ®å’Œæƒé™æ•°æ®çš„æ•°æ®æºã€‚   </li><li>ç³»ç»ŸåŸºäºrbacæƒé™æ¨¡å‹ï¼Œæ”¯æŒbasicè®¤è¯ï¼Œdigestè®¤è¯ï¼Œjwtè®¤è¯ã€‚  </li><li>èƒ½ç»†ç²’åº¦çš„æ§åˆ¶ç”¨æˆ·å¯¹ç³»ç»Ÿæä¾›çš„restful apiçš„è®¿é—®æƒé™ï¼Œå³å“ªäº›ç”¨æˆ·èƒ½è®¿é—®å“ªäº›apiã€‚  </li></ol><p>å¤šè¯´æ— ç›Šï¼Œå¿«é€Ÿå¼€å§‹ï¼  </p><p>è¿™é‡Œä¸ºäº†ç…§é¡¾åˆ°åˆšå…¥é—¨çš„åŒå­¦ï¼Œå›¾æ–‡å±•ç¤ºäº†æ¯ä¸€æ­¥æ“ä½œã€‚æœ‰åŸºç¡€å¯ç›´æ¥ç•¥è¿‡ã€‚  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="åˆå§‹åŒ–ä¸€ä¸ªspringboot-webå·¥ç¨‹"></a>åˆå§‹åŒ–ä¸€ä¸ªspringboot webå·¥ç¨‹<a class="hash-link" href="#åˆå§‹åŒ–ä¸€ä¸ªspringboot-webå·¥ç¨‹" title="Direct link to heading">#</a></h3><p>åœ¨IDEAå¦‚ä¸‹æ“ä½œ:  </p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c2bc0a723ea74c86a75952cc486367cb~tplv-k3u1fbpfcp-zoom-1.image" alt="image"></p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/00d3cd3a015b4a079c0b30da064139d0~tplv-k3u1fbpfcp-zoom-1.image" alt="image"></p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3be963ed9c28493d9ddc3b48caab54af~tplv-k3u1fbpfcp-zoom-1.image" alt="image"></p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2bcce3d56cb244b6967914a5b9b807c5~tplv-k3u1fbpfcp-zoom-1.image" alt="image"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="æä¾›ä¸€äº›æ¨¡æ‹Ÿçš„restful-api"></a>æä¾›ä¸€äº›æ¨¡æ‹Ÿçš„restful api<a class="hash-link" href="#æä¾›ä¸€äº›æ¨¡æ‹Ÿçš„restful-api" title="Direct link to heading">#</a></h3><p>æ–°å»ºä¸€ä¸ªcontroller, åœ¨é‡Œé¢å®ç°ä¸€äº›ç®€å•çš„restful apiä¾›å¤–éƒ¨æµ‹è¯•è°ƒç”¨  </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">/**</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"> * simulate api controller, for testing</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"> * @author tomsun28</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"> * @date 17:35 2019-05-12</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"> */</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@RestController</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public class SimulateController {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    /** access success message **/</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    public static final String SUCCESS_ACCESS_RESOURCE = &quot;access this resource success&quot;;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    @GetMapping(&quot;/api/v1/source1&quot;)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    public ResponseEntity&lt;String&gt; api1Mock1() {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        return ResponseEntity.ok(SUCCESS_ACCESS_RESOURCE);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    @PutMapping(&quot;/api/v1/source1&quot;)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    public ResponseEntity&lt;String&gt; api1Mock3() {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        return ResponseEntity.ok(SUCCESS_ACCESS_RESOURCE);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    @DeleteMapping(&quot;/api/v1/source1&quot;)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    public ResponseEntity&lt;String&gt; api1Mock4() {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        return ResponseEntity.ok(SUCCESS_ACCESS_RESOURCE);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    @GetMapping(&quot;/api/v1/source2&quot;)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    public ResponseEntity&lt;String&gt; api1Mock5() {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        return ResponseEntity.ok(SUCCESS_ACCESS_RESOURCE);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    @GetMapping(&quot;/api/v1/source2/{var1}/{var2}&quot;)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    public ResponseEntity&lt;String&gt; api1Mock6(@PathVariable String var1, @PathVariable Integer var2 ) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        return ResponseEntity.ok(SUCCESS_ACCESS_RESOURCE);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    @PostMapping(&quot;/api/v2/source3/{var1}&quot;)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    public ResponseEntity&lt;String&gt; api1Mock7(@PathVariable String var1) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        return ResponseEntity.ok(SUCCESS_ACCESS_RESOURCE);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    @GetMapping(&quot;/api/v1/source3&quot;)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    public ResponseEntity&lt;String&gt; api1Mock11(HttpServletRequest request) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        return ResponseEntity.ok(SUCCESS_ACCESS_RESOURCE);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    @GetMapping(&quot;/api/v2/source2&quot;)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    public ResponseEntity&lt;String&gt; api1Mock12() {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        return ResponseEntity.ok(SUCCESS_ACCESS_RESOURCE);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="é¡¹ç›®ä¸­åŠ å…¥surenessä¾èµ–"></a>é¡¹ç›®ä¸­åŠ å…¥surenessä¾èµ–<a class="hash-link" href="#é¡¹ç›®ä¸­åŠ å…¥surenessä¾èµ–" title="Direct link to heading">#</a></h3><p>åœ¨é¡¹ç›®çš„pom.xmlåŠ å…¥surenessçš„mavenä¾èµ–åæ ‡    </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">&lt;dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    &lt;groupId&gt;com.usthe.sureness&lt;/groupId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    &lt;artifactId&gt;sureness-core&lt;/artifactId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    &lt;version&gt;1.0.3&lt;/version&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">&lt;/dependency&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>å¦‚ä¸‹ï¼š  </p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1c0df60e4bae4d4b80c0209f461fc8b5~tplv-k3u1fbpfcp-zoom-1.image" alt="image"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ä½¿ç”¨é»˜è®¤é…ç½®æ¥é…ç½®sureness"></a>ä½¿ç”¨é»˜è®¤é…ç½®æ¥é…ç½®sureness<a class="hash-link" href="#ä½¿ç”¨é»˜è®¤é…ç½®æ¥é…ç½®sureness" title="Direct link to heading">#</a></h3><p>æ–°å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œåˆ›å»ºå¯¹åº”çš„surenessé»˜è®¤é…ç½®bean<br>
surenessé»˜è®¤é…ç½®ä½¿ç”¨äº†æ–‡ä»¶æ•°æ®æº<code>sureness.yml</code>ä½œä¸ºè´¦æˆ·æƒé™æ•°æ®æº<br>
é»˜è®¤é…ç½®æ”¯æŒäº†<code>jwt, basic auth, digest auth</code>è®¤è¯  </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@Configuration</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public class SurenessConfiguration {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    /**</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">     * sureness default config bean</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">     * @return default config bean</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">     */</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    @Bean</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    public DefaultSurenessConfig surenessConfig() {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        return new DefaultSurenessConfig();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="é…ç½®é»˜è®¤æ–‡æœ¬é…ç½®æ•°æ®æº"></a>é…ç½®é»˜è®¤æ–‡æœ¬é…ç½®æ•°æ®æº<a class="hash-link" href="#é…ç½®é»˜è®¤æ–‡æœ¬é…ç½®æ•°æ®æº" title="Direct link to heading">#</a></h3><p>è®¤è¯é‰´æƒå½“ç„¶ä¹Ÿéœ€è¦æˆ‘ä»¬è‡ªå·±çš„é…ç½®æ•°æ®:è´¦æˆ·æ•°æ®ï¼Œè§’è‰²æƒé™æ•°æ®ç­‰<br>
è¿™äº›é…ç½®æ•°æ®å¯èƒ½æ¥è‡ªæ–‡æœ¬ï¼Œå…³ç³»æ•°æ®åº“ï¼Œéå…³ç³»æ•°æ®åº“<br>
æˆ‘ä»¬è¿™é‡Œä½¿ç”¨é»˜è®¤çš„æ–‡æœ¬å½¢å¼é…ç½® - sureness.yml, åœ¨resourceèµ„æºç›®å½•ä¸‹åˆ›å»ºsureness.ymlæ–‡ä»¶<br>
åœ¨sureness.ymlæ–‡ä»¶é‡Œé…ç½®æˆ‘ä»¬çš„è§’è‰²æƒé™æ•°æ®å’Œè´¦æˆ·æ•°æ®ï¼Œå¦‚ä¸‹ï¼š  </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">## -- sureness.ymlæ–‡æœ¬æ•°æ®æº -- ##</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"># åŠ è½½åˆ°åŒ¹é…å­—å…¸çš„èµ„æº,ä¹Ÿå°±æ˜¯éœ€è¦è¢«ä¿æŠ¤çš„,è®¾ç½®äº†æ‰€æ”¯æŒè§’è‰²è®¿é—®çš„èµ„æº</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"># æ²¡æœ‰é…ç½®çš„èµ„æºä¹Ÿé»˜è®¤è¢«è®¤è¯ä¿æŠ¤,ä½†ä¸é‰´æƒï¼Œä¾‹å¦‚/api/v1/source2===get</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"># eg: /api/v1/source1===get===[role2] è¡¨ç¤º /api/v1/source1===get è¿™æ¡èµ„æºæ”¯æŒ role2è¿™ä¸€ç§è§’è‰²è®¿é—®</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"># eg: /api/v2/source2===get===[] è¡¨ç¤º /api/v1/source2===get è¿™æ¡èµ„æºä¸æ”¯æŒä»»ä½•è§’è‰²è®¿é—®</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">resourceRole:</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  - /api/v1/source1===get===[role2]</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  - /api/v1/source1===delete===[role3]</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  - /api/v1/source1===put===[role1,role2]</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  - /api/v2/source2===get===[]</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  - /api/v1/source2/*/*===get===[role2]</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  - /api/v2/source3/*===get===[role2]</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"># éœ€è¦è¢«è¿‡æ»¤ä¿æŠ¤çš„èµ„æº,ä¸è®¤è¯é‰´æƒç›´æ¥è®¿é—®</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"># /api/v1/source3===get è¡¨ç¤º /api/v1/source3===get å¯ä»¥è¢«ä»»ä½•äººè®¿é—® æ— éœ€ç™»å½•è®¤è¯é‰´æƒ</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">excludedResource:</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  - /api/v1/account/auth===post</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  - /api/v1/source3===get</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  - /**/*.html===get</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  - /**/*.js===get</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  - /**/*.css===get</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  - /**/*.ico===get</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"># ç”¨æˆ·è´¦æˆ·ä¿¡æ¯</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"># ä¸‹é¢æœ‰ admin root tomä¸‰ä¸ªè´¦æˆ·</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"># eg: admin æ‹¥æœ‰[role1,role2]è§’è‰²,æ˜æ–‡å¯†ç ä¸ºadmin,åŠ ç›å¯†ç ä¸º0192023A7BBD73250516F069DF18B500</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"># eg: root æ‹¥æœ‰[role1],å¯†ç ä¸ºæ˜æ–‡23456</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"># eg: tom æ‹¥æœ‰[role3],å¯†ç ä¸ºæ˜æ–‡32113</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">account:</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  - appId: admin</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    # å¦‚æœå¡«å†™äº†åŠ å¯†ç›--salt,åˆ™credentialä¸ºMD5(password+salt)çš„32ä½ç»“æœ</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    # æ²¡æœ‰ç›è®¤ä¸ºä¸åŠ å¯†,credentialä¸ºæ˜æ–‡</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    # è‹¥å¯†ç åŠ ç› åˆ™digestè®¤è¯ä¸æ”¯æŒ  </span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    credential: 0192023A7BBD73250516F069DF18B500</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    salt: 123</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    role: [role1,role2]</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  - appId: root</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    credential: 23456</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    role: [role1]</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  - appId: tom</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    credential: 32113</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    role: [role3]</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="æ·»åŠ è¿‡æ»¤å™¨æ‹¦æˆªæ‰€æœ‰è¯·æ±‚å¯¹æ‰€æœ‰è¯·æ±‚è¿›è¡Œè®¤è¯é‰´æƒ"></a>æ·»åŠ è¿‡æ»¤å™¨æ‹¦æˆªæ‰€æœ‰è¯·æ±‚,å¯¹æ‰€æœ‰è¯·æ±‚è¿›è¡Œè®¤è¯é‰´æƒ<a class="hash-link" href="#æ·»åŠ è¿‡æ»¤å™¨æ‹¦æˆªæ‰€æœ‰è¯·æ±‚å¯¹æ‰€æœ‰è¯·æ±‚è¿›è¡Œè®¤è¯é‰´æƒ" title="Direct link to heading">#</a></h3><p>æ–°å»ºä¸€ä¸ªfilter, æ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼Œç”¨surenesså¯¹æ‰€æœ‰è¯·æ±‚è¿›è¡Œè®¤è¯é‰´æƒã€‚è®¤è¯é‰´æƒå¤±è´¥çš„è¯·æ±‚surenessä¼šæŠ›å‡ºå¯¹åº”çš„å¼‚å¸¸ï¼Œæˆ‘ä»¬æ•è·å“åº”çš„å¼‚å¸¸è¿›è¡Œå¤„ç†è¿”å›responseå³å¯ã€‚  </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@Order(1)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@WebFilter(filterName = &quot;SurenessFilterExample&quot;, urlPatterns = &quot;/*&quot;, asyncSupported = true)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public class SurenessFilterExample implements Filter {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    @Override</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    public void init(FilterConfig filterConfig) {}</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    @Override</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    public void destroy() {}</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    @Override</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            throws IOException, ServletException {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        try {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            SubjectSum subject = SurenessSecurityManager.getInstance().checkIn(servletRequest);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            // è®¤è¯é‰´æƒæˆåŠŸåˆ™ä¼šè¿”å›å¸¦ç”¨æˆ·ä¿¡æ¯çš„subject å¯ä»¥å°†subjectä¿¡æ¯ç»‘å®šåˆ°å½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡holderä¾›åé¢ä½¿ç”¨</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            if (subject != null) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                SurenessContextHolder.bindSubject(subject);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        } catch (ProcessorNotFoundException | UnknownAccountException | UnsupportedSubjectException e4) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            // è´¦æˆ·åˆ›å»ºç›¸å…³å¼‚å¸¸</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            responseWrite(ResponseEntity</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                    .status(HttpStatus.BAD_REQUEST).body(e4.getMessage()), servletResponse);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            return;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        } catch (DisabledAccountException | ExcessiveAttemptsException e2 ) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            // è´¦æˆ·ç¦ç”¨ç›¸å…³å¼‚å¸¸</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            responseWrite(ResponseEntity</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                    .status(HttpStatus.UNAUTHORIZED).body(e2.getMessage()), servletResponse);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            return;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        } catch (IncorrectCredentialsException | ExpiredCredentialsException e3) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            // è®¤è¯å¤±è´¥ç›¸å…³å¼‚å¸¸</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            responseWrite(ResponseEntity</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                    .status(HttpStatus.UNAUTHORIZED).body(e3.getMessage()), servletResponse);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            return;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        } catch (NeedDigestInfoException e5) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            // digestè®¤è¯éœ€è¦é‡è¯•å¼‚å¸¸</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            responseWrite(ResponseEntity</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                    .status(HttpStatus.UNAUTHORIZED)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                    .header(&quot;WWW-Authenticate&quot;, e5.getAuthenticate()).build(), servletResponse);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            return;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        } catch (UnauthorizedException e6) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            // é‰´æƒå¤±è´¥ç›¸å…³å¼‚å¸¸ï¼Œå³æ— æƒè®¿é—®æ­¤api</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            responseWrite(ResponseEntity</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                    .status(HttpStatus.FORBIDDEN).body(e6.getMessage()), servletResponse);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            return;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        } catch (RuntimeException e) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            // å…¶ä»–å¼‚å¸¸</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            responseWrite(ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build(),</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                    servletResponse);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            return;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        try {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            // è‹¥æœªæŠ›å‡ºå¼‚å¸¸ åˆ™è®¤è¯é‰´æƒæˆåŠŸ ç»§ç»­ä¸‹é¢è¯·æ±‚æµç¨‹</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            filterChain.doFilter(servletRequest, servletResponse);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        } finally {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            SurenessContextHolder.clear();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    /**</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">     * write response json data</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">     * @param content content</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">     * @param response response</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">     */</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    private static void responseWrite(ResponseEntity content, ServletResponse response) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        response.setCharacterEncoding(&quot;UTF-8&quot;);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        response.setContentType(&quot;application/json;charset=utf-8&quot;);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        ((HttpServletResponse)response).setStatus(content.getStatusCodeValue());</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        content.getHeaders().forEach((key, value) -&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                ((HttpServletResponse) response).addHeader(key, value.get(0)));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        try (PrintWriter printWriter = response.getWriter()) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            if (content.getBody() != null) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                if (content.getBody() instanceof String) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                    printWriter.write(content.getBody().toString());</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                } else {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                    ObjectMapper objectMapper = new ObjectMapper();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                    printWriter.write(objectMapper.writeValueAsString(content.getBody()));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            } else {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                printWriter.flush();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        } catch (IOException e) {}</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>åƒä¸Šé¢ä¸€æ ·ï¼Œ</p><ol><li>è‹¥è®¤è¯é‰´æƒæˆåŠŸ,<code>checkIn</code>ä¼šè¿”å›åŒ…å«ç”¨æˆ·ä¿¡æ¯çš„<code>SubjectSum</code>å¯¹è±¡  </li><li>è‹¥ä¸­é—´è®¤è¯é‰´æƒå¤±è´¥ï¼Œ<code>checkIn</code>ä¼šæŠ›å‡ºä¸åŒç±»å‹çš„è®¤è¯é‰´æƒå¼‚å¸¸,ç”¨æˆ·éœ€æ ¹æ®è¿™äº›å¼‚å¸¸æ¥ç»§ç»­åé¢çš„æµç¨‹(è¿”å›ç›¸åº”çš„è¯·æ±‚å“åº”)</li></ol><p>ä¸ºäº†ä½¿filteråœ¨springbootç”Ÿæ•ˆ éœ€è¦åœ¨bootå¯åŠ¨ç±»åŠ æ³¨è§£ <code>@ServletComponentScan</code>   </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@SpringBootApplication</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@ServletComponentScan</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public class BootstrapApplication {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    public static void main(String[] args) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        SpringApplication.run(BootstrapApplication.class, args);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ä¸€åˆ‡å®Œæ¯•ï¼ŒéªŒè¯æµ‹è¯•"></a>ä¸€åˆ‡å®Œæ¯•ï¼ŒéªŒè¯æµ‹è¯•<a class="hash-link" href="#ä¸€åˆ‡å®Œæ¯•ï¼ŒéªŒè¯æµ‹è¯•" title="Direct link to heading">#</a></h3><p>é€šè¿‡ä¸Šé¢çš„æ­¥éª¤ æˆ‘ä»¬çš„ä¸€ä¸ªå®Œæ•´åŠŸèƒ½è®¤è¯é‰´æƒé¡¹ç›®å°±æ­å»ºå®Œæˆäº†ï¼Œæœ‰åŒå­¦æƒ³ å°±è¿™å‡ æ­¥éª¤ å®ƒçš„å®Œæ•´åŠŸèƒ½ä½“ç°åœ¨å“ªé‡Œå•Š èƒ½æ”¯æŒå•¥ã€‚  </p><p>è¿™ä¸ªæ­å¥½çš„è®¤è¯é‰´æƒé¡¹ç›®åŸºäºrbacæƒé™æ¨¡å‹ï¼Œæ”¯æŒ baisc è®¤è¯ï¼Œdigestè®¤è¯, jwtè®¤è¯ã€‚èƒ½ç»†ç²’åº¦çš„æ§åˆ¶ç”¨æˆ·å¯¹åå°æä¾›çš„restful apiçš„è®¿é—®æƒé™ï¼Œå³å“ªäº›ç”¨æˆ·èƒ½è®¿é—®å“ªäº›apiã€‚ æˆ‘ä»¬è¿™é‡Œæ¥æµ‹è¯•ä¸€ä¸‹ã€‚ </p><p>IDEAä¸Šå¯åŠ¨å·¥ç¨‹é¡¹ç›®ã€‚  </p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="basicè®¤è¯æµ‹è¯•"></a>basicè®¤è¯æµ‹è¯•<a class="hash-link" href="#basicè®¤è¯æµ‹è¯•" title="Direct link to heading">#</a></h5><p>èµ„æºapi/v1/source2===getæ²¡æœ‰é…ç½®åˆ°æ–‡æœ¬æ•°æ®æºé‡Œï¼Œä»£è¡¨æ‰€æœ‰è§’è‰²æˆ–æ— è§’è‰²éƒ½å¯ä»¥è®¿é—® å‰ææ˜¯è®¤è¯æˆåŠŸï¼Œç”¨è¯¥èµ„æºæ¥åšè®¤è¯æµ‹è¯•</p><p><strong>è®¤è¯æˆåŠŸ</strong>ï¼š  </p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a09f6caa4ef845adb9f5b5fa6e86040b~tplv-k3u1fbpfcp-zoom-1.image" alt="image"></p><p><strong>å¯†ç é”™è¯¯</strong>ï¼š  </p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/caa656a9a9174df6afc8768dc859ecb6~tplv-k3u1fbpfcp-zoom-1.image" alt="image"></p><p><strong>è´¦æˆ·ä¸å­˜åœ¨</strong>ï¼š  </p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/37d8c0d0cd144b4fb8cfd5e0a47e6961~tplv-k3u1fbpfcp-zoom-1.image" alt="image"></p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="digestè®¤è¯æµ‹è¯•"></a>digestè®¤è¯æµ‹è¯•<a class="hash-link" href="#digestè®¤è¯æµ‹è¯•" title="Direct link to heading">#</a></h5><p><strong>æ³¨æ„å¦‚æœå¯†ç é…ç½®äº†åŠ å¯†ç›ï¼Œåˆ™æ— æ³•ä½¿ç”¨digestè®¤è¯</strong>  </p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/53fe5e08301c4171b31b6180a77b5837~tplv-k3u1fbpfcp-zoom-1.image" alt="image"></p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c12598db019549efa5f990c0136e7582~tplv-k3u1fbpfcp-zoom-1.image" alt="image"></p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="jwtè®¤è¯æµ‹è¯•"></a>jwtè®¤è¯æµ‹è¯•<a class="hash-link" href="#jwtè®¤è¯æµ‹è¯•" title="Direct link to heading">#</a></h5><p>jwtè®¤è¯é¦–å…ˆä½ å¾—æ‹¥æœ‰ä¸€ä¸ªç­¾å‘çš„jwtï¼Œåˆ›å»ºå¦‚ä¸‹apiæ¥å£æä¾›jwtç­¾å‘- <code>/api/v1/account/auth</code>  </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@RestController()</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public class AccountController {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    private static final String APP_ID = &quot;appId&quot;;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    /**</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">     * account data provider</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">     */</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    private SurenessAccountProvider accountProvider = new DocumentAccountProvider();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    /**</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">     * login, this provider a get jwt api, convenient to test other api with jwt</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">     * @param requestBody request</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">     * @return response</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">     *</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">     */</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    @PostMapping(&quot;/api/v1/account/auth&quot;)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    public ResponseEntity&lt;Object&gt; login(@RequestBody Map&lt;String,String&gt; requestBody) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        if (requestBody == null || !requestBody.containsKey(APP_ID)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                || !requestBody.containsKey(&quot;password&quot;)) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            return ResponseEntity.badRequest().build();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        String appId = requestBody.get(&quot;appId&quot;);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        String password = requestBody.get(&quot;password&quot;);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        SurenessAccount account = accountProvider.loadAccount(appId);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        if (account == null || account.isDisabledAccount() || account.isExcessiveAttempts()) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            return ResponseEntity.status(HttpStatus.FORBIDDEN).build();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        if (account.getPassword() != null) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            if (account.getSalt() != null) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                password = Md5Util.md5(password + account.getSalt());</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            if (!account.getPassword().equals(password)) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                return ResponseEntity.status(HttpStatus.FORBIDDEN).build();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        // Get the roles the user has - rbac</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        List&lt;String&gt; roles = account.getOwnRoles();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        long refreshPeriodTime = 36000L;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        // issue jwt</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        String jwt = JsonWebTokenUtil.issueJwt(UUID.randomUUID().toString(), appId,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                &quot;token-server&quot;, refreshPeriodTime &gt;&gt; 1, roles,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                null, Boolean.FALSE);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        Map&lt;String, String&gt; body = Collections.singletonMap(&quot;token&quot;, jwt);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        return ResponseEntity.ok().body(body);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>è¯·æ±‚apiæ¥å£ç™»å½•è®¤è¯è·å–jwt</strong>    </p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3295df4eb54d4deb8498d3ae51aadcb8~tplv-k3u1fbpfcp-zoom-1.image" alt="image"></p><p><strong>æºå¸¦ä½¿ç”¨è·å–çš„jwtå€¼è¯·æ±‚apiæ¥å£</strong>    </p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ec0f95fe506946df8b14c8fab5ffd9f2~tplv-k3u1fbpfcp-zoom-1.image" alt="image">
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fb6b8c67ec474e229ba37e62654651d5~tplv-k3u1fbpfcp-zoom-1.image" alt="image"></p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="é‰´æƒæµ‹è¯•"></a>é‰´æƒæµ‹è¯•<a class="hash-link" href="#é‰´æƒæµ‹è¯•" title="Direct link to heading">#</a></h5><p>é€šè¿‡ä¸Šé¢çš„sureness.ymlæ–‡ä»¶é…ç½®çš„ç”¨æˆ·-è§’è‰²-èµ„æºï¼Œæˆ‘ä»¬å¯ä»¥å…³è”ä¸‹é¢å‡ ä¸ªå…¸å‹æµ‹è¯•ç‚¹  </p><ol><li><code>/api/v1/source3===get</code>èµ„æºå¯ä»¥è¢«ä»»ä½•ç›´æ¥è®¿é—®ï¼Œä¸éœ€è¦è®¤è¯é‰´æƒ  </li><li><code>api/v1/source2===get</code>èµ„æºæŒæ‰€æœ‰è§’è‰²æˆ–æ— è§’è‰²è®¿é—® å‰ææ˜¯è®¤è¯æˆåŠŸ  </li><li>ç”¨æˆ·adminèƒ½è®¿é—®<code>/api/v1/source1===get</code>èµ„æº,è€Œç”¨æˆ·root,tomæ— æƒé™  </li><li>ç”¨æˆ·tomèƒ½è®¿<code>/api/v1/source1===delete</code>èµ„æºï¼Œè€Œç”¨æˆ·admin.rootæ— æƒé™<br>æµ‹è¯•å¦‚ä¸‹ï¼š  </li></ol><p><strong><code>/api/v1/source3===get</code>èµ„æºå¯ä»¥è¢«ä»»ä½•ç›´æ¥è®¿é—®ï¼Œä¸éœ€è¦è®¤è¯é‰´æƒ</strong><br>
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ae2b3db8d7b64c9abf18c243943f7a4d~tplv-k3u1fbpfcp-zoom-1.image" alt="image"></p><p><strong><code>api/v1/source2===get</code>èµ„æºæŒæ‰€æœ‰è§’è‰²æˆ–æ— è§’è‰²è®¿é—® å‰ææ˜¯è®¤è¯æˆåŠŸ</strong><br>
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ace184c86cc5438f91f7614b961dfab1~tplv-k3u1fbpfcp-zoom-1.image" alt="image"></p><p><strong>ç”¨æˆ·adminèƒ½è®¿é—®<code>/api/v1/source1===get</code>èµ„æº,è€Œç”¨æˆ·root,tomæ— æƒé™</strong><br>
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f5fcd36befa84fb59b49c3cc35cb206e~tplv-k3u1fbpfcp-zoom-1.image" alt="image">
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/45f9454365ef4a45abc90e436eb0d2f0~tplv-k3u1fbpfcp-zoom-1.image" alt="image"></p><p><strong>ç”¨æˆ·tomèƒ½è®¿<code>/api/v1/source1===delete</code>èµ„æºï¼Œè€Œç”¨æˆ·admin.rootæ— æƒé™</strong><br>
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e9bce40c97dd4aaf9924845922c4917b~tplv-k3u1fbpfcp-zoom-1.image" alt="image">
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/209598b7717947c585bf479817b24726~tplv-k3u1fbpfcp-zoom-1.image" alt="image"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="å…¶ä»–"></a>å…¶ä»–<a class="hash-link" href="#å…¶ä»–" title="Direct link to heading">#</a></h3><p>è¿™æ¬¡å›¾æ–‡ä¸€æ­¥ä¸€æ­¥çš„è¯¦ç»†æè¿°äº†æ„å»ºä¸€ä¸ªç®€å•ä½†å®Œæ•´çš„è®¤è¯é‰´æƒé¡¹ç›®çš„æµç¨‹ï¼Œå½“ç„¶é‡Œé¢çš„æˆæƒè´¦æˆ·ç­‰ä¿¡æ¯æ˜¯å†™åœ¨é…ç½®æ–‡ä»¶é‡Œé¢çš„ï¼Œå®é™…çš„é¡¹ç›®æ˜¯ä¼šæŠŠè¿™äº›æ•°æ®å†™åœ¨æ•°æ®åº“ä¸­ã€‚
ä¸‡å˜ä¸ç¦»å…¶å®—ï¼Œæ— è®ºæ˜¯å†™é…ç½®æ–‡ä»¶è¿˜æ˜¯æ•°æ®åº“ï¼Œå®ƒåªæ˜¯ä½œä¸ºæ•°æ®æºæä¾›æ•°æ®ï¼ŒåŸºäºsurenessæˆ‘ä»¬ä¹Ÿèƒ½è½»æ¾å¿«é€Ÿæ„å»ºåŸºäºæ•°æ®åº“çš„è®¤è¯é‰´æƒé¡¹ç›®ï¼Œæ”¯æŒåŠ¨æ€åˆ·æ–°ç­‰å„ç§åŠŸèƒ½ã€‚  </p><p>åŸºäºæ•°æ®åº“æ–¹æ¡ˆçš„é¡¹ç›®å¯å‚è€ƒä¸‹æ–¹æ ·ä¾‹-&gt;surenessé›†æˆspringbootæ ·ä¾‹(æ•°æ®åº“æ–¹æ¡ˆ), æ­¤æ¬¡ä¸€æ­¥ä¸€æ­¥å®Œæˆçš„ç³»ç»Ÿæºä»£ç ä¹Ÿåœ¨ä¸‹æ–¹ -&gt; surenessé›†æˆspringbootæ ·ä¾‹(é…ç½®æ–‡ä»¶æ–¹æ¡ˆ)   </p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="demoæºä»£ç ä»“åº“"></a>DEMOæºä»£ç ä»“åº“<a class="hash-link" href="#demoæºä»£ç ä»“åº“" title="Direct link to heading">#</a></h4><p><a href="https://github.com/dromara/sureness/tree/master/sample-bootstrap" target="_blank" rel="noopener noreferrer">surenessé›†æˆspringbootæ ·ä¾‹-é…ç½®æ–‡ä»¶æ–¹æ¡ˆ</a><br>
<a href="https://github.com/dromara/sureness/tree/master/sample-tom" target="_blank" rel="noopener noreferrer">surenessé›†æˆspringbootæ ·ä¾‹-æ•°æ®åº“æ–¹æ¡ˆ</a></p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/sureness/zh-cn/blog/tags/integrate">integrate</a><a class="margin-horiz--sm" href="/sureness/zh-cn/blog/tags/startup">startup</a></div><div class="col text--right"><a aria-label="Read more about ä½¿ç”¨Surenessä¸€æ­¥ä¸€æ­¥æ­å»ºä¸€ä¸ªå®Œæ•´è®¤è¯é‰´æƒé¡¹ç›®" href="/sureness/zh-cn/blog/2021/06/06/step-by-step"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/sureness/zh-cn/blog/2021/04/29/sample-micronaut">Using Sureness to secure micronaut REST API</a></h2><div class="margin-vert--md"><time datetime="2021-04-29T00:00:00.000Z" class="blogPostDate_fNvV">2021å¹´4æœˆ29æ—¥ Â· One min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/ChineseTony" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/24618786?s=400&amp;v=4" alt="ChineseTony"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/ChineseTony" target="_blank" rel="noopener noreferrer">ChineseTony</a></h4><small class="avatar__subtitle"></small></div></div></header><div class="markdown"><p>Using Sureness to secure micronaut REST API by providing authentication(JWT,Basic,Digest) and authorization(RBAC)</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="what-you-will-learn"></a>What You Will Learn<a class="hash-link" href="#what-you-will-learn" title="Direct link to heading">#</a></h2><ul><li>Creating a simple REST API using micronaut</li><li>Learn how to integrate Sureness into a micronaut application</li><li>Test API authentication - use JWT Auth, Basic Auth, Digest Auth to test the security of the REST API</li><li>Test API authorization - use different users to verify that they can access the REST API</li></ul><p>The tutorial assumes that you know what  JWT, Basic Auth, Digest Auth, RBAC are. If you
do not, then you can check <a href="https://jwt.io/introduction/" target="_blank" rel="noopener noreferrer">jwt</a>, <a href="https://docs.oracle.com/cd/E50612_01/doc.11122/user_guide/content/authn_http_basic.html" target="_blank" rel="noopener noreferrer">basic auth</a> , <a href="https://docs.oracle.com/cd/E50612_01/doc.11122/user_guide/content/authn_http_digest.html" target="_blank" rel="noopener noreferrer">digest auth</a>, <a href="https://en.wikipedia.org/wiki/Role-based_access_control" target="_blank" rel="noopener noreferrer">rbac</a> for an introduction.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="setting-up-dependencies"></a>Setting Up Dependencies<a class="hash-link" href="#setting-up-dependencies" title="Direct link to heading">#</a></h2><p>First, you will need to create a maven project and add micronautn, Sureness dependencies coordinate</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    &lt;properties&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;release.version&gt;8&lt;/release.version&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;packaging&gt;jar&lt;/packaging&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;jdk.version&gt;1.8&lt;/jdk.version&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;micronaut.version&gt;2.4.3&lt;/micronaut.version&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;micronaut-maven-plugin.version&gt;1.1.8&lt;/micronaut-maven-plugin.version&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;maven-compiler-plugin.version&gt;3.8.1&lt;/maven-compiler-plugin.version&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;exec.mainClass&gt;com.usthe.sureness.micronaut.Application&lt;/exec.mainClass&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;micronaut.runtime&gt;netty&lt;/micronaut.runtime&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    &lt;/properties&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    &lt;dependencyManagement&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;dependencies&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                &lt;groupId&gt;io.micronaut&lt;/groupId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                &lt;artifactId&gt;micronaut-bom&lt;/artifactId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                &lt;version&gt;${micronaut.version}&lt;/version&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                &lt;type&gt;pom&lt;/type&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                &lt;scope&gt;import&lt;/scope&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;/dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;/dependencies&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    &lt;/dependencyManagement&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    &lt;dependencies&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;version&gt;1.7.30&lt;/version&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;/dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;groupId&gt;com.usthe.sureness&lt;/groupId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;artifactId&gt;sureness-core&lt;/artifactId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;/dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;groupId&gt;io.micronaut&lt;/groupId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;artifactId&gt;micronaut-inject&lt;/artifactId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;scope&gt;compile&lt;/scope&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;/dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;groupId&gt;io.micronaut&lt;/groupId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;artifactId&gt;micronaut-validation&lt;/artifactId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;scope&gt;compile&lt;/scope&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;/dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;scope&gt;runtime&lt;/scope&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;/dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;artifactId&gt;junit-jupiter-api&lt;/artifactId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;scope&gt;test&lt;/scope&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;/dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;artifactId&gt;junit-jupiter-engine&lt;/artifactId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;scope&gt;test&lt;/scope&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;/dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;groupId&gt;io.micronaut.test&lt;/groupId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;artifactId&gt;micronaut-test-junit5&lt;/artifactId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;scope&gt;test&lt;/scope&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;/dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;groupId&gt;io.micronaut&lt;/groupId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;artifactId&gt;micronaut-http-client&lt;/artifactId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;scope&gt;compile&lt;/scope&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;/dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;groupId&gt;io.micronaut&lt;/groupId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;artifactId&gt;micronaut-http-server-netty&lt;/artifactId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;scope&gt;compile&lt;/scope&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;/dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;groupId&gt;io.micronaut&lt;/groupId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;artifactId&gt;micronaut-runtime&lt;/artifactId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;scope&gt;compile&lt;/scope&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;/dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    &lt;/dependencies&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    &lt;build&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;plugins&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;plugin&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                &lt;groupId&gt;io.micronaut.build&lt;/groupId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                &lt;artifactId&gt;micronaut-maven-plugin&lt;/artifactId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                &lt;version&gt;${micronaut-maven-plugin.version}&lt;/version&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;/plugin&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;plugin&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                &lt;version&gt;${maven-compiler-plugin.version}&lt;/version&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                &lt;configuration&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                    &lt;annotationProcessorPaths combine.children=&quot;append&quot;&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                        &lt;path&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                            &lt;groupId&gt;io.micronaut&lt;/groupId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                            &lt;artifactId&gt;micronaut-inject-java&lt;/artifactId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                            &lt;version&gt;${micronaut.version}&lt;/version&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                        &lt;/path&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                        &lt;path&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                            &lt;groupId&gt;io.micronaut&lt;/groupId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                            &lt;artifactId&gt;micronaut-validation&lt;/artifactId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                            &lt;version&gt;${micronaut.version}&lt;/version&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                        &lt;/path&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                    &lt;/annotationProcessorPaths&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                    &lt;compilerArgs&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                        &lt;arg&gt;-Amicronaut.processing.group=com.usthe.sureness&lt;/arg&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                        &lt;arg&gt;-Amicronaut.processing.module=micronaut-sureness&lt;/arg&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                    &lt;/compilerArgs&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                &lt;/configuration&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;/plugin&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;/plugins&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    &lt;/build&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">     </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li><a href="https://docs.micronaut.io/2.4.3/guide/index.html" target="_blank" rel="noopener noreferrer">User Guide</a></li><li><a href="https://docs.micronaut.io/2.4.3/api/index.html" target="_blank" rel="noopener noreferrer">API Reference</a></li><li><a href="https://docs.micronaut.io/2.4.3/guide/configurationreference.html" target="_blank" rel="noopener noreferrer">Configuration Reference</a></li><li><a href="https://guides.micronaut.io/index.html" target="_blank" rel="noopener noreferrer">Micronaut Guides</a></li></ul><p>We need to create a simple micronautn app and provide some  REST API for test.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="setting-up-sureness"></a>Setting Up Sureness<a class="hash-link" href="#setting-up-sureness" title="Direct link to heading">#</a></h2><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1run-micronaut-application"></a>1.Run Micronaut Application<a class="hash-link" href="#1run-micronaut-application" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">import io.micronaut.runtime.Micronaut;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public class Application{</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    public static void main(String[] args) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        Micronaut.run(Application.class, args);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-config-document-datasource---surenessyml"></a>2. Config Document Datasource - <code>sureness.yml</code><a class="hash-link" href="#2-config-document-datasource---surenessyml" title="Direct link to heading">#</a></h4><p>Sureness authentication requires us to provide our own account data, role permission data. These data may come from document, databases,, annotations, etc. When we use sureness default configuration above, the datasource is document - <code>sureness.yml</code>.</p><p>Create a file named <code>sureness.yml</code> in the <code>resource</code> directory. Configure account data, role permission data in the <code>sureness.yml</code>.  eg:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token comment" style="color:rgb(106, 153, 85)">## -- sureness.yml document dataSource-- ##</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># load api resource which need be protected, config role who can access these resource.</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># resources that are not configured are also authenticated and protected by default, but not authorized</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># eg: /api/v2/host===post===[role2,role3] means /api/v2/host===post can be access by role2,role3</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># eg: /api/v1/source2===get===[] means /api/v1/source2===get can not be access by any role</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token key atrule">resourceRole</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /api/v1/source1===get===</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">role2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /api/v1/source1===post===</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">role1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /api/v1/source1===delete===</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">role3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /api/v1/source1===put===</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">role1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain">role2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /api/v1/source2===get===</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /api/v2/host===post===</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">role2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain">role3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /api/v2/host===get===</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">role2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain">role3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /api/v2/host===delete===</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">role2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain">role3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /api/v2/host===put===</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">role2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain">role3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /api/v3/</span><span class="token important">*===*===</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">role1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain">role2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain">role3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># load api resource which do not need be protected, means them need be excluded.</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># these api resource can be access by everyone</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token key atrule">excludedResource</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /api/v3/host===get</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /</span><span class="token important">**/*.html===get</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /</span><span class="token important">**/*.js===get</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /</span><span class="token important">**/*.css===get</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /</span><span class="token important">**/*.ico===get</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># account info</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># there are three account: admin, root, tom</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># eg: admin has [role1,role2] ROLE, unencrypted password is admin, encrypted password is 0192023A7BBD73250516F069DF18B500</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># eg: root has role1, unencrypted password is 23456</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># eg: tom has role3, unencrypted password is 32113</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token key atrule">account</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> </span><span class="token key atrule">appId</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"> admin</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)"># if add salt, the password is encrypted password - the result: MD5(password+salt)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)"># digest auth not support encrypted password</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)"># if no salt, the password is unencrypted password</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token key atrule">credential</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"> 0192023A7BBD73250516F069DF18B500</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token key atrule">salt</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"> </span><span class="token number">123</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token key atrule">role</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">role1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain">role2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> </span><span class="token key atrule">appId</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"> root</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token key atrule">credential</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"> </span><span class="token number">23456</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token key atrule">role</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">role1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain">role2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> </span><span class="token key atrule">appId</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"> tom</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token key atrule">credential</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"> </span><span class="token number">32113</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token key atrule">role</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">role3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-add-an-interceptor-intercepting-all-requests"></a>3. Add an Interceptor Intercepting All Requests<a class="hash-link" href="#3-add-an-interceptor-intercepting-all-requests" title="Direct link to heading">#</a></h4><p>The essence of sureness is to intercept all rest requests for authenticating and authorizing.     The interceptor can be a filter or interceptor, it intercepts all request to check them. In Micronaut, we use Filter</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@Filter(&quot;/**&quot;)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public class MicronautSurenessFilterExample  implements HttpServerFilter {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    private static final Logger logger = LoggerFactory.getLogger(MicronautSurenessFilterExample.class);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    @Inject</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    private SurenessSecurityManager securityManager ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    @Override</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    public Publisher&lt;MutableHttpResponse&lt;?&gt;&gt; doFilter(HttpRequest&lt;?&gt; request,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                                                             ServerFilterChain chain) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        Integer statusCode = null;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        String errorMsg = null;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        try {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            SubjectSum subject =securityManager.checkIn(request);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            if (subject != null) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                SurenessContextHolder.bindSubject(subject);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        } catch (ProcessorNotFoundException | UnknownAccountException | UnsupportedSubjectException e4) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            logger.debug(&quot;this request is illegal&quot;);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            statusCode = HttpStatus.BAD_REQUEST.getCode();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            errorMsg = e4.getMessage();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        } catch (DisabledAccountException | ExcessiveAttemptsException e2 ) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            logger.debug(&quot;the account is disabled&quot;);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            statusCode = HttpStatus.FORBIDDEN.getCode();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            errorMsg = e2.getMessage();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        } catch (IncorrectCredentialsException | ExpiredCredentialsException e3) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            logger.debug(&quot;this account credential is incorrect or expired&quot;);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            statusCode = HttpStatus.FORBIDDEN.getCode();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            errorMsg = e3.getMessage();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        } catch (UnauthorizedException e5) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            logger.debug(&quot;this account can not access this resource&quot;);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            statusCode = HttpStatus.FORBIDDEN.getCode();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            errorMsg = e5.getMessage();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        } catch (RuntimeException e) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            logger.error(&quot;other exception happen: &quot;, e);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            statusCode = HttpStatus.FORBIDDEN.getCode();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            errorMsg = e.getMessage();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        if (statusCode != null &amp;&amp; errorMsg != null) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            String finalErrorMsg = errorMsg;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            Integer finalStatusCode = statusCode;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            logger.info(statusCode+&quot;---&gt;&quot;+errorMsg);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            try {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                URI location = new URI(&quot;/auth/error&quot;);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                request = request.mutate().headers(httpHeaders -&gt; {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                    httpHeaders.add(&quot;statusCode&quot;, String.valueOf(finalStatusCode));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                    httpHeaders.add(&quot;errorMsg&quot;, finalErrorMsg);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                }).uri(location);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            }catch (URISyntaxException e){</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                logger.error(&quot;uri error&quot;);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        return chain.proceed(request);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    @Override</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    public int getOrder() {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        return ServerFilterPhase.SECURITY.order();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>SurenessSecurityManager configuration</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">import io.micronaut.context.annotation.Factory;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@Factory</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public class SurenessConfiguration {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    private static final Logger logger = LoggerFactory.getLogger(SurenessConfiguration.class);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    @Factory</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    public SurenessSecurityManager init() {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        SurenessAccountProvider accountProvider = new DocumentAccountProvider();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        List&lt;Processor&gt; processorList = new LinkedList&lt;&gt;();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        NoneProcessor noneProcessor = new NoneProcessor();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        processorList.add(noneProcessor);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        PasswordProcessor passwordProcessor = new PasswordProcessor();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        passwordProcessor.setAccountProvider(accountProvider);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        processorList.add(passwordProcessor);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        DefaultProcessorManager processorManager = new DefaultProcessorManager(processorList);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        if (logger.isDebugEnabled()) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            logger.debug(&quot;DefaultProcessorManager init&quot;);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        PathTreeProvider pathTreeProvider = new DocumentPathTreeProvider();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        DefaultPathRoleMatcher pathRoleMatcher = new DefaultPathRoleMatcher();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        pathRoleMatcher.setPathTreeProvider(pathTreeProvider);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        pathRoleMatcher.buildTree();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        if (logger.isDebugEnabled()) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            logger.debug(&quot;DefaultPathRoleMatcher init&quot;);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        // SubjectFactory init</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        SubjectFactory subjectFactory = new SurenessSubjectFactory();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        List&lt;SubjectCreate&gt; subjectCreates = Arrays.asList(</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                new NoneSubjectReactiveCreator(),</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                new BasicSubjectReactiveCreator());</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        subjectFactory.registerSubjectCreator(subjectCreates);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        if (logger.isDebugEnabled()) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            logger.debug(&quot;SurenessSubjectFactory init&quot;);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        // surenessSecurityManager init</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        SurenessSecurityManager securityManager = SurenessSecurityManager.getInstance();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        securityManager.setPathRoleMatcher(pathRoleMatcher);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        securityManager.setSubjectFactory(subjectFactory);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        securityManager.setProcessorManager(processorManager);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        if (logger.isDebugEnabled()) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            logger.debug(&quot;SurenessSecurityManager init&quot;);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        return securityManager;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="4-last-implement-auth-exception-handling-process"></a>4. Last, Implement Auth Exception Handling Process<a class="hash-link" href="#4-last-implement-auth-exception-handling-process" title="Direct link to heading">#</a></h4><p>Sureness uses exception handling process:</p><ul><li>If auth success, method - <code>checkIn()</code> will return a <code>SubjectSum</code> object containing user information.</li><li>If auth failure, method - <code>checkIn()</code> will throw different types of auth exceptions.</li></ul><p>We need to continue the subsequent process based on these exceptions.(eg: return the request response)</p><p>Here we need to customize the exceptions thrown by <code>checkIn</code>, passed directly when auth success, catch exception when auth failure and do something:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">// when auth error , add error msg to HttpRequest</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   if (statusCode != null &amp;&amp; errorMsg != null) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            String finalErrorMsg = errorMsg;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            Integer finalStatusCode = statusCode;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            logger.info(statusCode+&quot;---&gt;&quot;+errorMsg);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            try {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                URI location = new URI(&quot;/auth/error&quot;);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                request = request.mutate().headers(httpHeaders -&gt; {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                    httpHeaders.add(&quot;statusCode&quot;, String.valueOf(finalStatusCode));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                    httpHeaders.add(&quot;errorMsg&quot;, finalErrorMsg);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                }).uri(location);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            }catch (URISyntaxException e){</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                logger.error(&quot;uri error&quot;);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        } </span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>All done, we can test now!</strong></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="test"></a>Test<a class="hash-link" href="#test" title="Direct link to heading">#</a></h2><p>Through the above steps, a complete auth function project is completed. Someone maybe think that with only these few steps, where is its complete function and what can it support?<br>
This built project is based on the RBAC permission model and supports Baisc authentication, Digest authentication and JWT authentication. It can fine-grained control the user&#x27;s access to the restful api provided by the Javalin. That is to control which users can access which api.</p><p>Let&#x27;s test it. (we use postman and chrome to test.)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="test-authentication"></a>Test Authentication<a class="hash-link" href="#test-authentication" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-basic-auth-test"></a>1. Basic Auth Test<a class="hash-link" href="#1-basic-auth-test" title="Direct link to heading">#</a></h4><p>Use postman Basic auth, as shown below:</p><ul><li>success - input username: admin, password: admin</li></ul><p><img alt="success" src="/sureness/zh-cn/assets/images/success-566c8b8e44aa014636b5ce56cef43aef.png"></p><ul><li>fail - input username: admin, password: admin1234</li></ul><p><img alt="fail" src="/sureness/zh-cn/assets/images/error-d143a3b62627677352d3ca8ca6ba2527.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="conclusion"></a>Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">#</a></h2><p>micronaut is a framework dedicated to simplicity and ease of use, and so is Sureness.<br>
We hope you enjoy this tutorial. Of course, the tutorial only introduces a simple introduction. Our account data, role permission data can not only be written in <code>sureness.yml</code>, but also loaded and obtained from the database and annotations. We can also customize the authentication method, data source, etc.<br>
Finally, thank you again for reading.</p><p><a href="https://github.com/usthe/sureness/tree/master/samples/javalin-sureness" target="_blank" rel="noopener noreferrer">DEMO SOURCE CODE ON GITHUB</a></p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/sureness/zh-cn/blog/tags/integrate">integrate</a></div><div class="col text--right"><a aria-label="Read more about Using Sureness to secure micronaut REST API" href="/sureness/zh-cn/blog/2021/04/29/sample-micronaut"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/sureness/zh-cn/blog/2021/04/16/sample-javalin">Using Sureness to secure Javalin REST API</a></h2><div class="margin-vert--md"><time datetime="2021-04-16T00:00:00.000Z" class="blogPostDate_fNvV">2021å¹´4æœˆ16æ—¥ Â· One min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/tomsun28" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/24788200?s=400&amp;v=4" alt="tom"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/tomsun28" target="_blank" rel="noopener noreferrer">tom</a></h4><small class="avatar__subtitle">Java Engineer</small></div></div></header><div class="markdown"><p><a href="https://github.com/tomsun28/sureness/tree/master/samples/javalin-sureness" target="_blank" rel="noopener noreferrer">javalin-sureness sample repository</a></p><p>Using Sureness to secure Javalin REST API by providing authentication(JWT,Basic,Digest) and authorization(RBAC)</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="what-you-will-learn"></a>What You Will Learn<a class="hash-link" href="#what-you-will-learn" title="Direct link to heading">#</a></h2><ul><li>Creating a simple REST API using Javalin</li><li>Learn how to integrate Sureness into a Javalin application</li><li>Learn how to issue a JWT</li><li>Test API authentication - use JWT Auth, Basic Auth, Digest Auth to test the security of the REST API</li><li>Test API authorization - use different users to verify that they can access the REST API</li></ul><p>The tutorial assumes that you know what  JWT, Basic Auth, Digest Auth, RBAC are. If you
do not, then you can check <a href="https://jwt.io/introduction/" target="_blank" rel="noopener noreferrer">jwt</a>, <a href="https://docs.oracle.com/cd/E50612_01/doc.11122/user_guide/content/authn_http_basic.html" target="_blank" rel="noopener noreferrer">basic auth</a> , <a href="https://docs.oracle.com/cd/E50612_01/doc.11122/user_guide/content/authn_http_digest.html" target="_blank" rel="noopener noreferrer">digest auth</a>, <a href="https://en.wikipedia.org/wiki/Role-based_access_control" target="_blank" rel="noopener noreferrer">rbac</a> for an introduction.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="setting-up-dependencies"></a>Setting Up Dependencies<a class="hash-link" href="#setting-up-dependencies" title="Direct link to heading">#</a></h2><p>First, you will need to create a maven project and add Javalin, Sureness dependencies coordinate</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;groupId&gt;io.javalin&lt;/groupId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;artifactId&gt;javalin&lt;/artifactId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;version&gt;{{site.javalinversion}}&lt;/version&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;/dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;groupId&gt;com.usthe.sureness&lt;/groupId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;artifactId&gt;sureness-core&lt;/artifactId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;version&gt;1.0.2&lt;/version&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;/dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;dependency&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            &lt;version&gt;1.7.30&lt;/version&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        &lt;/dependency&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="setting-up-javalin-and-create-rest-api"></a>Setting Up Javalin and Create REST API<a class="hash-link" href="#setting-up-javalin-and-create-rest-api" title="Direct link to heading">#</a></h2><p>We need to create a simple Javalin app and provide some  REST API for test.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        // init javalin</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        Javalin app = Javalin.create().start(8088);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        // create simple rest api</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        // simple rest api</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        app.routes(() -&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            path(&quot;api&quot;, () -&gt; {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                path(&quot;v3&quot;, () -&gt; {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                    get(&quot;host&quot;, ctx -&gt; ctx.result(&quot;get /api/v3/host success&quot;));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                    put(&quot;book&quot;, ctx -&gt; ctx.result(&quot;put /api/v3/book success&quot;));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                });</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                path(&quot;v2&quot;, () -&gt; {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                    path(&quot;host&quot;, () -&gt; {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                        get(ctx -&gt; ctx.result(&quot;get /api/v2/host success&quot;));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                        post(ctx -&gt; ctx.result(&quot;post /api/v2/host success&quot;));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                        put(ctx -&gt; ctx.result(&quot;put /api/v2/host success&quot;));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                        delete(ctx -&gt; ctx.result(&quot;delete /api/v2/host success&quot;));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                    });</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                });</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                path(&quot;v1&quot;, () -&gt; {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                    path(&quot;source1&quot;, () -&gt; {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                        get(ctx -&gt; ctx.result(&quot;get /api/v1/source1 success&quot;));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                        post(ctx -&gt; ctx.result(&quot;post /api/v1/source1 success&quot;));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                        put(ctx -&gt; ctx.result(&quot;put /api/v1/source1 success&quot;));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                        delete(ctx -&gt; ctx.result(&quot;delete /api/v1/source1 success&quot;));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                    });</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                });</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            }));</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="setting-up-sureness"></a>Setting Up Sureness<a class="hash-link" href="#setting-up-sureness" title="Direct link to heading">#</a></h2><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-use-the-default-configuration-to-configure-sureness"></a>1. Use the Default Configuration to Configure Sureness<a class="hash-link" href="#1-use-the-default-configuration-to-configure-sureness" title="Direct link to heading">#</a></h4><p>The default configuration -<code>DefaultSurenessConfig</code> uses the document datasource <code>sureness.yml</code> as the auth datasource.<br>
It supports JWT, Basic Auth, Digest Auth authentication.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    public static void main(String[] args) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        // init sureness default config</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        new DefaultSurenessConfig();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-config-document-datasource---surenessyml"></a>2. Config Document Datasource - <code>sureness.yml</code><a class="hash-link" href="#2-config-document-datasource---surenessyml" title="Direct link to heading">#</a></h4><p>Sureness authentication requires us to provide our own account data, role permission data. These data may come from document, databases,, annotations, etc. When we use sureness default configuration above, the datasource is document - <code>sureness.yml</code>.</p><p>Create a file named <code>sureness.yml</code> in the <code>resource</code> directory. Configure account data, role permission data in the <code>sureness.yml</code>.  eg:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token comment" style="color:rgb(106, 153, 85)">## -- sureness.yml document dataSource-- ##</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># load api resource which need be protected, config role who can access these resource.</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># resources that are not configured are also authenticated and protected by default, but not authorized</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># eg: /api/v2/host===post===[role2,role3] means /api/v2/host===post can be access by role2,role3</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># eg: /api/v1/source2===get===[] means /api/v1/source2===get can not be access by any role</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token key atrule">resourceRole</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /api/v1/source1===get===</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">role2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /api/v1/source1===post===</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">role1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /api/v1/source1===delete===</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">role3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /api/v1/source1===put===</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">role1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain">role2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /api/v1/source2===get===</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /api/v2/host===post===</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">role2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain">role3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /api/v2/host===get===</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">role2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain">role3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /api/v2/host===delete===</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">role2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain">role3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /api/v2/host===put===</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">role2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain">role3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /api/v3/</span><span class="token important">*===*===</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">role1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain">role2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain">role3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># load api resource which do not need be protected, means them need be excluded.</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># these api resource can be access by everyone</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token key atrule">excludedResource</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /api/v3/host===get</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /</span><span class="token important">**/*.html===get</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /</span><span class="token important">**/*.js===get</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /</span><span class="token important">**/*.css===get</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> /</span><span class="token important">**/*.ico===get</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># account info</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># there are three account: admin, root, tom</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># eg: admin has [role1,role2] ROLE, unencrypted password is admin, encrypted password is 0192023A7BBD73250516F069DF18B500</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># eg: root has role1, unencrypted password is 23456</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># eg: tom has role3, unencrypted password is 32113</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token key atrule">account</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> </span><span class="token key atrule">appId</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"> admin</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)"># if add salt, the password is encrypted password - the result: MD5(password+salt)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)"># digest auth not support encrypted password</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)"># if no salt, the password is unencrypted password</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token key atrule">credential</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"> 0192023A7BBD73250516F069DF18B500</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token key atrule">salt</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"> </span><span class="token number">123</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token key atrule">role</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">role1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain">role2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> </span><span class="token key atrule">appId</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"> root</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token key atrule">credential</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"> </span><span class="token number">23456</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token key atrule">role</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">role1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain">role2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">-</span><span class="token plain"> </span><span class="token key atrule">appId</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"> tom</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token key atrule">credential</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"> </span><span class="token number">32113</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token key atrule">role</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">role3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-add-an-interceptor-intercepting-all-requests"></a>3. Add an Interceptor Intercepting All Requests<a class="hash-link" href="#3-add-an-interceptor-intercepting-all-requests" title="Direct link to heading">#</a></h4><p>The essence of sureness is to intercept all rest requests for authenticating and authorizing.     The interceptor can be a filter or interceptor, it intercepts all request to check them. In Javalin, we use <code>app.before()</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        // intercept all rest requests for authenticating and authorizing</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        app.before(ctx -&gt; {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            SubjectSum subject = SurenessSecurityManager.getInstance().checkIn(ctx.req);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            // when auth error , the exception throw, you should use app.exception() catch it and define return</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            if (subject != null) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                SurenessContextHolder.bindSubject(subject);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        });</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        app.after(ctx -&gt;  SurenessContextHolder.unbindSubject());</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="4-last-implement-auth-exception-handling-process"></a>4. Last, Implement Auth Exception Handling Process<a class="hash-link" href="#4-last-implement-auth-exception-handling-process" title="Direct link to heading">#</a></h4><p>Sureness uses exception handling process:</p><ul><li>If auth success, method - <code>checkIn()</code> will return a <code>SubjectSum</code> object containing user information.</li><li>If auth failure, method - <code>checkIn()</code> will throw different types of auth exceptions.</li></ul><p>We need to continue the subsequent process based on these exceptions.(eg: return the request response)</p><p>Here we need to customize the exceptions thrown by <code>checkIn</code>, passed directly when auth success, catch exception when auth failure and do something:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        // when auth error , the exception throw, you should use app.exception() catch it and define return</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        app.exception(UnknownAccountException.class, (e, ctx) -&gt; {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            log.debug(&quot;this request user account not exist&quot;);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            ctx.status(401).result(e.getMessage());</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        }).exception(IncorrectCredentialsException.class, (e, ctx) -&gt; {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            log.debug(&quot;this account credential is incorrect&quot;);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            ctx.status(401).result(e.getMessage());</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        }).exception(ExpiredCredentialsException.class, (e, ctx) -&gt; {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            log.debug(&quot;this account credential expired&quot;);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            ctx.status(401).result(e.getMessage());</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        }).exception(NeedDigestInfoException.class, (e, ctx) -&gt; {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            log.debug(&quot;you should try once again with digest auth information&quot;);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            ctx.status(401).header(&quot;WWW-Authenticate&quot;, e.getAuthenticate());</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        }).exception(UnauthorizedException.class, (e, ctx) -&gt; {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            log.debug(&quot;this account can not access this resource&quot;);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            ctx.status(403).result(e.getMessage());</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        }).exception(Exception.class, (e, ctx) -&gt; {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            log.error(&quot;other exception happen: &quot;, e);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            ctx.status(500).result(e.getMessage());</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        });</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="provide-an-issue-jwt-api"></a>Provide an Issue JWT Api<a class="hash-link" href="#provide-an-issue-jwt-api" title="Direct link to heading">#</a></h2><p>Now we provide a REST API to issue JWT. We can use this JWT to test JWT auth.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       // issue jwt rest api</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        app.get(&quot;/auth/token&quot;, ctx -&gt; {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            SubjectSum subjectSum = SurenessContextHolder.getBindSubject();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            if (subjectSum == null) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                ctx.result(&quot;Please auth!&quot;);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            } else {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                String principal = (String) subjectSum.getPrincipal();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                List&lt;String&gt; roles = (List&lt;String&gt;) subjectSum.getRoles();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                // issue jwt</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                String jwt = JsonWebTokenUtil.issueJwt(UUID.randomUUID().toString(), principal,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                        &quot;token-server&quot;, 3600L, roles);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                ctx.result(jwt);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        });</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>All done, we can test now!</strong></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="test"></a>Test<a class="hash-link" href="#test" title="Direct link to heading">#</a></h2><p>Through the above steps, a complete auth function project is completed. Someone maybe think that with only these few steps, where is its complete function and what can it support?<br>
This built project is based on the RBAC permission model and supports Baisc authentication, Digest authentication and JWT authentication. It can fine-grained control the user&#x27;s access to the restful api provided by the Javalin. That is to control which users can access which api.</p><p>Let&#x27;s test it. (we use postman and chrome to test.)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="test-authentication"></a>Test Authentication<a class="hash-link" href="#test-authentication" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-basic-auth-test"></a>1. Basic Auth Test<a class="hash-link" href="#1-basic-auth-test" title="Direct link to heading">#</a></h4><p>Use postman Basic auth, as shown below:</p><ul><li>success - input username: admin, password: admin</li></ul><p><img alt="success" src="/sureness/zh-cn/assets/images/test1-af3495bc45a9116b5401c8c1b40f32eb.PNG"></p><ul><li>fail - input username: admin, password: 12345</li></ul><p><img alt="fail" src="/sureness/zh-cn/assets/images/test2-04e523ebd1c8c584b328d365a6524ad1.PNG"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-digest-auth-test"></a>2. Digest Auth Test<a class="hash-link" href="#2-digest-auth-test" title="Direct link to heading">#</a></h4><p>Note: If password has been encrypted,  Digest auth not support.(So the account admin not support Digest auth).<br>
Use chrome to Digest auth, as shown below:</p><p><img alt="success" src="/sureness/zh-cn/assets/images/test3-3ef3fd841ccac2285197c8ba50d7e93c.PNG"></p><p><img alt="success" src="data:image/png;base64,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"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-jwt-auth-test"></a>3. JWT Auth Test<a class="hash-link" href="#3-jwt-auth-test" title="Direct link to heading">#</a></h4><p>First, we should access <strong>[GET /auth/token]</strong> api to get a JWT to use, as shown below:</p><p><img alt="success" src="/sureness/zh-cn/assets/images/test5-3618d00ade7d90f24539c08ed3320bf1.PNG"></p><p>Then, use the JWT as Bearer Token to access REST API, as shown below:</p><p><img alt="success" src="/sureness/zh-cn/assets/images/test6-05c520dab5b7dbbc0252e6bbbe9750b0.PNG"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="test-authorization"></a>Test Authorization<a class="hash-link" href="#test-authorization" title="Direct link to heading">#</a></h3><ul><li>success - user <strong>tom</strong> has role <strong>role3</strong>, the api <strong>[DELETE - /api/v2/host]</strong> support <strong>role3</strong> access, so <strong>tom</strong> can access api <strong>[DELETE - /api/v2/host]</strong> success, as shown below:</li></ul><p><img alt="success" src="/sureness/zh-cn/assets/images/test7-ba23c5f0d743f865c1fc24ac44a7f06c.PNG"></p><ul><li>fail - user <strong>tom</strong> only has role <strong>role3</strong>, the api <strong>[GET - /api/v1/source1]</strong> only support <strong>role2</strong> access, not support <strong>role3</strong>,  so <strong>tom</strong> can not access api <strong>[GET - /api/v1/source1]</strong>, as shown below:</li></ul><p><img alt="fail" src="/sureness/zh-cn/assets/images/test8-cd9aaab2d2d892093a58e62724a8da99.PNG"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="conclusion"></a>Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">#</a></h2><p>Javalin is a framework dedicated to simplicity and ease of use, and so is Sureness.<br>
We hope you enjoy this tutorial. Of course, the tutorial only introduces a simple introduction. Our account data, role permission data can not only be written in <code>sureness.yml</code>, but also loaded and obtained from the database and annotations. We can also customize the authentication method, data source, etc.<br>
Finally, thank you again for reading.</p><p><a href="https://github.com/usthe/sureness/tree/master/samples/javalin-sureness" target="_blank" rel="noopener noreferrer">DEMO SOURCE CODE ON GITHUB</a></p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/sureness/zh-cn/blog/tags/integrate">integrate</a></div><div class="col text--right"><a aria-label="Read more about Using Sureness to secure Javalin REST API" href="/sureness/zh-cn/blog/2021/04/16/sample-javalin"><strong>Read More</strong></a></div></footer></article></div></main></div></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">å…³äº Sureness</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/dromara/sureness" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li><li class="footer__item"><a href="https://gitee.com/dromara/sureness" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitee</a></li><li class="footer__item"><a href="https://github.com/tomsun28/sureness-shiro-spring-security-benchmark" target="_blank" rel="noopener noreferrer" class="footer__link-item">é«˜æ€§èƒ½</a></li><li class="footer__item"><a href="https://github.com/dromara/sureness/projects/1" target="_blank" rel="noopener noreferrer" class="footer__link-item">çœ‹æ¿</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">ç¤¾åŒºä¸äº¤æµ</h4><ul class="footer__items"><li class="footer__item"><a href="https://dromara.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Dromara</a></li><li class="footer__item"><a href="https://github.com/dromara/sureness/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github Discussion</a></li><li class="footer__item"><a href="https://gitter.im/usthe/sureness" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitter Channel</a></li><li class="footer__item"><a href="https://qm.qq.com/cgi-bin/qm/qr?k=3IpzQjFOztJe464_eMBmDHfT0YTWK5Qa&amp;jump_from=webapi" target="_blank" rel="noopener noreferrer" class="footer__link-item">QQ Group - 282870345</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">æ›´å¤šç›¸å…³</h4><ul class="footer__items"><li class="footer__item"><a href="https://blog.usthe.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Tom Blog</a></li><li class="footer__item"><a href="https://github.com/usthe" target="_blank" rel="noopener noreferrer" class="footer__link-item">USTHE</a></li><li class="footer__item"><a href="https://github.com/tomsun28" target="_blank" rel="noopener noreferrer" class="footer__link-item">Tom</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://github.com/dromara" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/sureness/zh-cn/img/dromara.jpg" alt="Open Source Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/sureness/zh-cn/img/dromara.jpg" alt="Open Source Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Apache License 2.0 | Copyright Â© 2021</div></div></div></footer></div>
<script src="/sureness/zh-cn/assets/js/runtime~main.0b379c3a.js"></script>
<script src="/sureness/zh-cn/assets/js/main.578398a9.js"></script>
</body>
</html>